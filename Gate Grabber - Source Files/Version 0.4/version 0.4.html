<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Test</title>
    <style>
        * { padding: 0; margin: 0; }
        canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
    
</head>
<body>



<canvas id="myCanvas" width="480" height="600"></canvas>
<img  id= "ANDGate" src = "Resources/Gates/and.png" style = "visibility: hidden; height:10; width:10;">
<img  id= "ORGate" src = "Resources/Gates/or.png" style = "visibility: hidden; height:10; width:10;">
<script>

    var previousFrameTime = 0;
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");
    var gate1=document.getElementById("ANDGate");
    var gate2=document.getElementById("ORGate");
    var ballRadius=10;
    var upPressed = false;
    var downPressed = false;
    var rightPressed = false;
    var leftPressed = false;
    var spacePressed = false;

    var ballX = canvas.width/2;
    var ballY = canvas.height-30;
    var gateX1 = canvas.width/4;
    var gateX2 = 2*(canvas.width/4);
    var gateX3 = 3*(canvas.width/4);
    var gateY = -20;
    var currentGate1 = 0;
    var currentGate2 = 1;
    var currentGate3 = 0;
    //var gate1;
    //var gate2;
    //var gate3;
    var gate1Need = 0;
    var gate2Need = 1;
    var gate3Need = 0;
    var match = false;
    var playerValue = 1;
    var score = 0;
    var lives = 10;



    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);


    /*Key Handlers

    keyDownhandler()
        -If one of the specified keys is pressed down, dectected by the key code, the value for that key is set to true.
    keyUpHandler()
        -If one of the specified keys is released, dectected by the key code, the value for that key is set to false.

    Keys Detected(key code):
    -Right Arrow(39) 
    -Left Arrow(37)
    -Up Arrow(38)
    -Down Arrow(40) 
    -Space Bar (32)              


    */
    function keyDownHandler(e) {
        if(e.keyCode == 39) {
            rightPressed = true;        
        }
        if(e.keyCode == 37) {
            leftPressed = true;
        }
        if(e.keyCode == 38){
            upPressed = true;

        }
        if(e.keyCode == 40){
            downPressed = true;
        }
        if(e.keyCode == 32){
            spacePressed = true;
        }
    }

    function keyUpHandler(e) {
        if(e.keyCode == 39) {
            rightPressed = false;
        }
        if(e.keyCode == 37) {
            leftPressed = false;
        }
        if(e.keyCode == 38){
            upPressed = false;

        }
        if(e.keyCode == 40){
            downPressed = false;
        }
        if(e.keyCode == 32){
            spacePressed = false;
        }
    }

    //  drawBall()
    //  Creates ball at the bottom of the screen to represent the player.
    function drawBall(){
        ctx.beginPath();
        ctx.arc(ballX, ballY, ballRadius, 0, Math.PI*2);
        ctx.fillStyle = "#000000";
        ctx.fill();
        ctx.closePath();

    }
    /*  drawGate()
        Creates a gate based on given the x and y coordinates and an integer value represtening which gate to create.
        Gates:
            -AND     0
            -OR      1
            //-NAND    2   to be added
            //-XOR     3   to be added
    */
    function drawGate(x, y, gate){
        if(gate== 0){
            ctx.beginPath();
            ctx.drawImage(gate1,x, y, 60, 120);
            //ctx.rect(x,y, 40, 60);
            //ctx.fillStyle = "#0000FF";
            //ctx.fill();
            ctx.closePath();  
        }
        else if(gate ==1){
            ctx.beginPath();
            ctx.drawImage(gate2,x, y, 60, 120);
            // ctx.rect(x,y, 40, 60);
            // ctx.fillStyle = "#FF0000";
            // ctx.fill();
            ctx.closePath();
        }
        
    }

    /*  changeGate()
        Function called to change the gates that are output. Each gate has a value that will satisfy the logic. The value is randomly slected between 0 or 1. For now the number that determines the gate, that is the value that satisfies that "gate". 
        
    */
    function changeGate(){
        //Randomly gives the player a new value of 0 or 1.
        playerValue = Math.floor(Math.random()*2);
    
        //V Change value of the first gate V
        var temp = Math.floor(Math.random() * 2);
        while(temp == currentGate1){
            temp = Math.floor(Math.random() * 2);
        }
        currentGate1 = temp;
        gate1Need = temp;

        //V change the value of the second gate V

        temp = Math.floor(Math.random() * 2);
        while(temp == currentGate2){
            temp = Math.floor(Math.random() * 2);
        }
        currentGate2 = temp;
        gate2Need = temp;

        //V change the value of the third gate V

        temp = Math.floor(Math.random() * 2);
        while(temp == currentGate3){
            temp = Math.floor(Math.random() * 2);
        }
        currentGate3 = temp;
        gate3Need = temp;


        // if(currentGate1 == 0){
        //     currentGate1 = 1;
        // }
        // else if(currentGate1 == 1){
        //     currentGate1 = 2;
        // }
        // else{
        //     currentGate1 = 0;
    }
    /*  checkMatch()
        Function called to check whether the player's value matches the gate the player grabbed.

    */
    function checkMatch(gate){
        if(gate == "gate1"){
            if(gate1Need == playerValue){
                score += 100;
            }else lives -= 1;
        }
        else if(gate == "gate2"){
            if(gate2Need == playerValue){
                score+= 100;
            }else lives -= 1;
        }
        else if(gate =="gate3"){
            if(gate3Need == playerValue){
                score+= 100;
            }else lives -= 1;
        }
        else{
            lives -= 1;       
        }

    }

    /*  checkCollision()
        This function is called everytime the screen is drawn. It checks whether the gates have either hit the bottom of the window or have hit the ball. This is done by checking the the x and y coordinates of the ball and the gates. If the gates hit the bottom of the window, they are reset and the player loses a life. If the gates come in contact with the ball, the player's vlaue and the gates needed value are checked. If they match, the score is increased by 100. If the values don't match, the player loses a life.

    */
    function checkCollision(){

        if((gateY+60) == canvas.height){
            
            changeGate();
            gateY=0;
            lives -= 1;
        } 
        if(ballX >=gateX1 && ballX <= (gateX1+45) && (gateY+95) == (ballRadius + ballY)){
            checkMatch("gate1");
            changeGate();
            gateY=0;
        }
        if(ballX >=gateX2 && ballX <= (gateX2+45) && (gateY+95) == (ballRadius + ballY)){
            checkMatch("gate2");
            changeGate();
            gateY=0;
        }
        if(ballX >=gateX3 && ballX <= (gateX3+45) && (gateY+95) == (ballRadius + ballY)){
            checkMatch("gate3");
            changeGate();
            gateY=0;
        }
    }
    /*  draw()
        This is the main function that draws the screen which includes the three gates, ball, score, lives, and FPS. The rate that the screen is drawn at varries.This is what frames per second(FPS) is in the top corner of the screen. 
    
        IF the left or right arrows are pressed  the x coordinate of the ball is chnaged; right arrow= +4, left arrow -4.
        The Y coordinate of the gates is increased, creating the animation of the gates falling.
        If the space bar is pressed the player's value  will change from 0 to 1 or vice versa. (kinda glitchy)

    */ 

    function draw(time) {
        requestAnimationFrame(draw);
        var FPS = Math.floor(1000 / (time - previousFrameTime));
        var fpsSTRING = FPS.toString();
        previousFrameTime = time;
        ctx.font = "12px Verdana";
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillText(fpsSTRING, 0, 10);
        ctx.fillText("FPS", 20, 10);
        ctx.fillText("Score:", 0, 30);
        ctx.fillText(score, 40, 30);
        ctx.fillText("Lives:", 0, 50);
        ctx.fillText(lives, 40, 50);
        ctx.fillText("Current Value:", 0, 600);
        ctx.fillText(playerValue, 95, 600);
        ctx.fillText(gate1Need, canvas.width/4, 10);
        ctx.fillText(gate2Need, (2*(canvas.width/4)), 10);
        ctx.fillText(gate3Need, (3*(canvas.width/4)), 10);



        checkCollision();
     

        drawGate(gateX1, gateY, currentGate1);

        drawGate(gateX2, gateY, currentGate2);

        drawGate(gateX3, gateY, currentGate3);

        drawBall();
        ctx.fillStyle="#FFFF00";
        ctx.fillText(playerValue, ballX-4, ballY+2);

        gateY = gateY + 1;

        if (rightPressed && ballX + ballRadius < canvas.width) {
            ballX += 4;
        }
        if (leftPressed && ballX - ballRadius > 0) {
            ballX -= 4;
        }
        if(spacePressed){
            if(playerValue == 0){
                playerValue = 1;
            }
            else{
                playerValue = 0;
            }
        }
        // if (upPressed && y - ballRadius > 0) {
        //      -= 4;
        // }

        // if (downPressed && y + ballRadius < canvas.height) {
        //     y += 4;
        // }


    }

    requestAnimationFrame(draw);


</script>

</body>
</html>